<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ü–∞–ø–∞ –¢—Ä—É–±–æ–∫ ‚Äî –ú–æ—è –∏–≥—Ä–∞</title>
    <link rel="stylesheet" href="main.css">
</head>
<body>
    <div class="container">
        <div class="papyrus">
            <div class="hieroglyph-border"></div>
            <div class="torn-edge top-edge"></div>
            <div class="torn-edge right-edge"></div>
            <div class="torn-edge bottom-edge"></div>
            <div class="torn-edge left-edge"></div>
            <div class="worn-spot spot1"></div>
            <div class="worn-spot spot2"></div>
            <div class="worn-spot spot3"></div>
            <div class="scarab top-left">ìÜ£</div>
            <div class="scarab top-right">ìÜ£</div>
            <div class="scarab bottom-left">ìÜ£</div>
            <div class="scarab bottom-right">ìÜ£</div>

            <div id="gameMain" style="display: block;">
                <div class="title">
                    <h1>–í–∞—à–∞ –∫–æ–º–Ω–∞—Ç–∞</h1>
                </div>
                <div class="game-room" id="gameRoom">
                    <div class="game-room-header">
                        <h2 class="game-room-title" id="gameRoomTitle">–ö–æ–º–Ω–∞—Ç–∞</h2>
                        <span class="game-room-status" id="gameRoomStatus">–û–∂–∏–¥–∞–Ω–∏–µ</span>
                    </div>
                    <div class="question-box">
                        <h3>–í–æ–ø—Ä–æ—Å:</h3>
                        <p class="question-text" id="gameQuestionText">‚Äî</p>
                    </div>
                    <div class="game-room-info">
                        <div class="game-room-players">
                            <span class="game-room-player" id="gameRoomPlayers">–ò–≥—Ä–æ–∫–æ–≤: 0/10</span>
                            <span class="game-room-player" id="gameRoomAnswers">–û—Ç–≤–µ—Ç–æ–≤: 0</span>
                        </div>
                    </div>
                    <div id="gameActions"></div>
                </div>
                <div id="userAnswerDisplay" style="display: none;"></div>
            </div>
        </div>
    </div>
    <script src="game.js"></script>
    <script src="userAnswer.js"></script>
    <script src="auth.js"></script>
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è
        let preventUnload = true;

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        function blockPageUnload() {
            console.log('–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã');
            
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –≤—Å–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è
            window.onbeforeunload = function(e) {
                e.preventDefault();
                e.returnValue = '';
                return '';
            };

            // –ë–ª–æ–∫–∏—Ä—É–µ–º –∞–ø–ø–∞—Ä–∞—Ç–Ω—É—é –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
            window.history.pushState(null, null, window.location.href);
            window.onpopstate = function() {
                window.history.pushState(null, null, window.location.href);
            };

            // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –≤—Å–µ —Å–æ–±—ã—Ç–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è
            window.addEventListener('beforeunload', function(e) {
                if (preventUnload) {
                    e.preventDefault();
                    e.returnValue = '';
                    return '';
                }
            }, { capture: true });

            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
            document.addEventListener('backbutton', function(e) {
                e.preventDefault();
                return false;
            }, false);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞
        function safePageTransition(url) {
            console.log(`–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É: ${url}`);
            
            // –í—Ä–µ–º–µ–Ω–Ω–æ —Ä–∞–∑—Ä–µ—à–∞–µ–º –ø–µ—Ä–µ—Ö–æ–¥
            preventUnload = false;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º ID –∏–≥—Ä—ã
            const gameId = new URLSearchParams(window.location.search).get('id');
            if (gameId) {
                localStorage.setItem('papaTrubok_lastGameId', gameId);
            }
            
            // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –Ω–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            window.location.href = url;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            blockPageUnload();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π ID –∏–≥—Ä—ã
            const savedGameId = localStorage.getItem('papaTrubok_lastGameId');
            const currentGameId = new URLSearchParams(window.location.search).get('id');
            
            if (savedGameId && savedGameId !== currentGameId) {
                // –ï—Å–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π ID –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è, –æ–±–Ω–æ–≤–ª—è–µ–º URL
                window.history.replaceState(null, '', `game.html?id=${savedGameId}`);
                location.reload();
            }
        });

        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è
        window.addEventListener('unload', function(e) {
            if (preventUnload) {
                e.preventDefault();
                return '';
            }
        }, { capture: true });

        // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é –∑–∞–∫—Ä—ã—Ç–∏—è
        document.oncontextmenu = function(e) {
            e.preventDefault();
            return false;
        };
    </script>
</body>
</html> 